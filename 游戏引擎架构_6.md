- - [toc]

    ## 6 资源及文件系统

    - 载入及管理多种媒体，包括纹理位图、三维网格数据、动画、音频片段、碰撞和物理数据、游戏世界布局
    - 由于内存空间的限制，游戏引擎应确保在同一时间，每个媒体文件只可载入一份
    - 多数游戏引擎采用某种类型的资源管理器，载入并管理构成三维游戏所需的资源
    - 游戏引擎有时会封装原生的文件系统API：
      - 便于跨平台
      - 支持操作系统文件系统不一定支持的功能

    ### 6.1 文件系统

    - 游戏引擎文件系统API提供的功能：
      - 操作文件名和路径
      - 开、关、读、写单独的文件
      - 扫描目录下的内容
      - 处理异步文件输入/输出请求

    #### 6.1.1 文件名和路径

    - 路径是一种描述文件系统层次中文件或目录的位置的字符串
    - 路径的形式一般如下：
      - 卷/目录1/目录2/....../目录N/文件名
      - 卷/目录1/目录2/....../目录(N-1)/目录N

    ##### 6.1.1.1 操作系统间的区别

    - 路径分隔符：
      - UNIX：正斜线
      - DOS、早期版本Windows：反斜线
      - 较新版本的Windows：允许以正或反斜线符分割，但某些应用程序不接受正斜线符
      - macOS 8和9：冒号
      - macOS X：基于UNIX，正斜线
    - 分卷：
      - UNIX及其变种：不支持以卷分开目录层次
      - Windows：定义卷：
        - 本机磁盘以单英文字母加冒号指明
        - 远端网络共享可挂接如本机磁盘，或使用双反斜线号加上远端计算机名字和共享目录/资源名指明
    - 文件名：
      - DOS、早期Windows：文件名最多只能含8个字符，以点号分隔后有3字符的扩展名
      - 后期Windows：文件名可包含多个点号，但仍将最后一个点号后的字符视为文件名的扩展名

    - 禁止出现的字符：
      - Windows和DOS：卷指示符外不得出现冒号
      - 某些情况增加转义符
    - 当前工作目录：
      - 通过cd设置当前工作目录
      - Windows：每个卷都有单独的当前工作目录，同时有当前工作卷
      - UNIX：只有一个当前工作目录
      - 游戏机使用一组预定义的路径前缀去表示多个卷

    ##### 6.1.1.2 绝对路径和相对路径

    - 绝对路径的首字符为路径分隔符
    - 相对路径不会以路径分隔符为首字符

    ##### 6.1.1.3 搜寻路径

    - 路径：文件系统下某文件/目录的字符串
    - 搜寻路径：含一串路径的字符串，各路径之间以特殊字符分隔，找文件时会从这些路径进行搜寻

    ##### 6.1.1.4 路径API

    - Windows提供了API以供从路径中分离目录/文件名/扩展名、使路径规范化、在绝对路径和相对路径之间进行转换等功能

    #### 6.1.2 基本文件I/O

    - 标准C程序库提供了两组API以开启、读取及写入文件内容，一组有缓冲功能，另一组无缓冲功能
      - 每次调用输入/输出时，都需要成为缓冲区的数据区块，以供程序和磁盘之间传送来源或目的字节
      - 当API负责管理所需的输入/输出数据缓冲时，就称之为有缓冲功能的I/O API
        - C标准程序库中有缓冲功能的I/O API有时被称为流输入/输出，他们将磁盘文件抽象为字节流
      - 否则，若需要由程序员负责管理数据缓冲时，则称之为无缓冲功能的API
    - 在UNIX及其变体中，标准C程序库的无缓冲I/O函数是原生的操作系统调用，但在Windows下，这些函数仅仅是底层API的包装
    - 管理自己的缓冲区可能是有用的

    ##### 6.1.2.1 包装还是不包装

    - 包装操作系统I/O API的好处：
      - 保证自定义的API在所有目标平台上均有相同的行为
      - API可以被简化，只剩下引擎实际需要的函数，降低维护工作量
      - 可提供延申功能，如处理不同媒体上的文件

    ##### 6.1.2.2 同步文件I/O

    - C标准库的两种文件I/O库都是同步的：
      - 程序发出I/O请求后，必须等待读/写数据完毕，程序才能继续运行

    #### 6.1.3 异步文件I/O

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    